name: "opendoas"
version: "6.8.2"
release: "1"
description: "Utility to execute a command as another user, sudo alternative"
sources:
  - "https://github.com/Duncaen/OpenDoas/releases/download/v$VERSION/opendoas-$VERSION.tar.gz"
sha256sum:
  - "28dca29adec5f4336465812d9e2243f599e62a78903de71c24f0cd6fe667edac"
depends:
  - "linux-pam"
  - "shadow"
build_depends:
  - "gmake"

build {
  macro build --prefix=/usr
  exec "make"
}

package {
  exec "make install"
  # From BLFS
  exec "mkdir -p $ROOT/etc/pam.d"
  write "$ROOT/etc/pam.d/doas << EOF" """
# Begin /etc/pam.d/doas

# include the default auth settings
auth      include     system-auth

# include the default account settings
account   include     system-account

# Set default environment variables for the service user
session   required    pam_env.so

# include system session defaults
session   include     system-session

# End /etc/pam.d/doas
"""
  exec "chmod 644 $ROOT/etc/pam.d/doas"

}

