#!/bin/sh
NAME="gnome-settings-daemon"
RELEASE="1"
VERSION="48.1"
SOURCES="https://gitlab.gnome.org/GNOME/gnome-settings-daemon/-/archive/$VERSION/gnome-settings-daemon-$VERSION.tar.gz"
BUILD_DEPENDS="meson"
DEPENDS="alsa-lib networkmanager colord fontconfig gcr-4 geoclue geocode-glib gnome-desktop lcms2 libcanberra libgweather libnotify libwacom pulseaudio upower wayland gnome-session"
SHA256SUM="d1f7c10004c4114e8562bbde4ebe980e8f2ca7be854521cd59b40819c46937f9"
DESCRIPTION="gnome-settings-daemon"

build() {
    
    rm -r subprojects/gvc
    git clone https://gitlab.gnome.org/GNOME/libgnome-volume-control subprojects/gvc
    cd subprojects/gvc
    git checkout 7a621180b46421e356b33972e3446775a504139c
    cd ../.. 

    if ! command -v systemctl > /dev/null; then
      # Credits to https://www.linuxfromscratch.org/blfs/view/svn/gnome/gnome-settings-daemon.html for these
      sed -e 's/libsystemd/libelogind/' \
        -i plugins/power/test.py
      systemd="false"
    else
      systemd="true" 
    fi

    meson setup \
    --prefix=/usr \
    --buildtype=release \
    -Dsystemd=$systemd \
    -Dsmartcard=false \
    -Dcups=false \
    -Dwwan=false \
    build
    ninja -C build
}

package() {
    DESTDIR="$ROOT" ninja -C build install
}
